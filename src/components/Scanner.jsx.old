import React, { Component } from 'react';
import Quagga from 'quagga';

class Scanner extends Component {
	render() {
		return <div id='interactive' className='viewport' />;
	}

	componentDidMount() {
		Quagga.init(
			{
				inputStream: {
					type: 'LiveStream',
					constraints: {
						facingMode: 'environment'	// or 'user'
					}
				},
				locator: {
					patchSize: 'medium',
					halfSample: true
				},
				numOfWorkers: 2,
				frequency: 10,
				decoder: {
					readers: [
						'ean_reader',
					]
				},
				locate: true
			},
			function(err) {
				if (err) {
					alert(err);
					return console.log(err);
				}
				Quagga.start();
			}
		);
		Quagga.onDetected(this.detectionHandler);
	}

	componentWillUnmount() {
		Quagga.offDetected(this.detectionHandler);
		Quagga.stop();
	}

	detectionHandler(result) {
		this.props.onDetected(result);
	};
}

export default Scanner;